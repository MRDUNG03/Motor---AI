<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Há»‡ thá»‘ng GiÃ¡m sÃ¡t Äá»™ng cÆ¡ CÃ´ng nghiá»‡p</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Hiá»‡u á»©ng chuyá»ƒn Ä‘á»™ng mÆ°á»£t mÃ  cho sidebar */
    .sidebar-item {
      transition: all 0.3s ease-in-out;
    }
    .sidebar-item:hover {
      transform: translateX(5px);
    }
    /* Hiá»‡u á»©ng cho main content */
    .main-content {
      animation: fadeIn 0.5s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    /* Tá»‘i Æ°u kÃ­ch thÆ°á»›c biá»ƒu Ä‘á»“ */
    .chart-container {
      width: 100%;
      height: 300px; /* Chiá»u cao lá»›n Ä‘á»ƒ vá»«a mÃ n hÃ¬nh */
    }
    /* ÄÃ¡nh dáº¥u má»¥c active */
    .sidebar-item.active {
      background-color: rgba(255, 255, 255, 0.1);
      font-weight: bold;
      border-left: 4px solid #ffffff;
    }
  </style>
</head>
<body class="bg-gray-50 font-sans antialiased">

  <div class="flex h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-gradient-to-b from-blue-700 to-blue-900 text-white shadow-xl">
      <div class="p-4 text-2xl font-extrabold border-b border-blue-500/30 flex items-center">
        <span class="mr-3">âš™ï¸</span>GiÃ¡m sÃ¡t Äá»™ng cÆ¡
      </div>
      <nav class="mt-4">
        <ul>
          <li class="px-4 py-3 text-lg hover:bg-blue-600/80 cursor-pointer rounded-r-lg flex items-center sidebar-item">
            <a href="home.html" class="flex items-center w-full"><span class="mr-3">ğŸ </span> Home</a>
          </li>
          <li class="px-4 py-3 text-lg hover:bg-blue-600/80 cursor-pointer rounded-r-lg flex items-center sidebar-item">
            <a href="datarealtime.html" class="flex items-center w-full"><span class="mr-3">ğŸ“ˆ</span> Dá»¯ Liá»‡u Thá»i Gian Thá»±c</a>
          </li>
          <li class="px-4 py-3 text-lg hover:bg-blue-600/80 cursor-pointer rounded-r-lg flex items-center sidebar-item">
            <a href="alert.html" class="flex items-center w-full"><span class="mr-3">ğŸ”</span> Chuáº©n ÄoÃ¡n Lá»—i</a>
          </li>
          <li class="px-4 py-3 text-lg hover:bg-blue-600/80 cursor-pointer rounded-r-lg flex items-center sidebar-item">
            <a href="history.html" class="flex items-center w-full"><span class="mr-3">ğŸ“‹</span> Lá»‹ch Sá»­ Sá»± cá»‘</a>
          </li>
          <li class="px-4 py-3 text-lg hover:bg-blue-600/80 cursor-pointer rounded-r-lg flex items-center sidebar-item">
            <a href="settings.html" class="flex items-center w-full"><span class="mr-3">âš™ï¸</span> CÃ i Äáº·t</a>
          </li>
          <li class="px-4 py-3 text-lg hover:bg-blue-600/80 cursor-pointer rounded-r-lg flex items-center sidebar-item">
            <a href="#" onclick="logout()" class="flex items-center w-full"><span class="mr-3">ğŸšª</span> ÄÄƒng Xuáº¥t</a>
          </li>
        </ul>
      </nav>
    </aside>

    <!-- Ná»™i dung chÃ­nh -->
    <main class="flex-1 p-4 main-content overflow-y-auto h-full">
      <!-- Header -->
      <div class="flex flex-col items-center mb-4">
        <h1 class="text-2xl font-bold text-gray-800 text-center">GiÃ¡m SÃ¡t Tráº¡ng ThÃ¡i TÃ­n Hiá»‡u Äá»™ng CÆ¡ Äiá»‡n</h1>
        <p class="text-sm text-gray-500 mt-1">Cáº­p nháº­t: <span id="current-time" class="font-semibold"></span></p>
      </div>

      <!-- Biá»ƒu Ä‘á»“ -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 h-[calc(100%-4rem)]">
        <!-- HÃ ng trÃªn -->
        <div class="bg-white rounded-xl shadow-lg p-3">
          <h3 class="text-sm font-semibold text-gray-800 text-center">Nhiá»‡t Ä‘á»™ (Â°C)</h3>
          <div class="chart-container">
            <canvas id="temperatureChart"></canvas>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-lg p-3">
          <h3 class="text-sm font-semibold text-gray-800 text-center">Rung Ä‘á»™ng (mm/s)</h3>
          <div class="chart-container">
            <canvas id="vibrationChart"></canvas>
          </div>
        </div>
        <!-- HÃ ng dÆ°á»›i -->
        <div class="bg-white rounded-xl shadow-lg p-3">
          <h3 class="text-sm font-semibold text-gray-800 text-center">Äiá»‡n Ã¡p (V)</h3>
          <div class="chart-container">
            <canvas id="voltageChart"></canvas>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-lg p-3">
          <h3 class="text-sm font-semibold text-gray-800 text-center">DÃ²ng Ä‘iá»‡n (A)</h3>
          <div class="chart-container">
            <canvas id="currentChart"></canvas>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // HÃ m Ä‘Äƒng xuáº¥t
    function logout() {
      localStorage.removeItem("username");
      alert("ÄÄƒng xuáº¥t thÃ nh cÃ´ng!");
      window.location.href = "login.html";
    }

    // Cáº­p nháº­t thá»i gian hiá»‡n táº¡i
    function updateTime() {
      const now = new Date();
      document.getElementById('current-time').textContent = now.toLocaleString('vi-VN');
    }
    updateTime();
    setInterval(updateTime, 1000);

    // Khá»Ÿi táº¡o cÃ¡c biá»ƒu Ä‘á»“
    const temperatureChart = new Chart(document.getElementById('temperatureChart').getContext('2d'), {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Nhiá»‡t Ä‘á»™ (Â°C)',
          data: [],
          borderColor: 'rgb(34, 197, 94)',
          backgroundColor: 'rgba(34, 197, 94, 0.1)',
          tension: 0.4,
          fill: true
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: false,
            title: {
              display: true,
              text: 'Nhiá»‡t Ä‘á»™ (Â°C)',
              color: 'gray',
              font: { size: 12 }
            },
            ticks: { color: 'gray', font: { size: 10 } },
            grid: { color: 'rgba(0,0,0,0.1)' }
          },
          x: {
            title: {
              display: true,
              text: 'Thá»i gian',
              color: 'gray',
              font: { size: 12 }
            },
            ticks: { color: 'gray', font: { size: 10 } },
            grid: { color: 'rgba(0,0,0,0.1)' }
          }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });

    const vibrationChart = new Chart(document.getElementById('vibrationChart').getContext('2d'), {
      type: 'line',
      data: {
        labels: [],
        datasets: [
          {
            label: 'Rung Ä‘á»™ng X (mm/s)',
            data: [],
            borderColor: 'rgb(239, 68, 68)',
            backgroundColor: 'rgba(239, 68, 68, 0.1)',
            tension: 0.4,
            fill: true
          },
          {
            label: 'Rung Ä‘á»™ng Y (mm/s)',
            data: [],
            borderColor: 'rgb(59, 130, 246)',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            tension: 0.4,
            fill: true
          },
          {
            label: 'Rung Ä‘á»™ng Z (mm/s)',
            data: [],
            borderColor: 'rgb(34, 197, 94)',
            backgroundColor: 'rgba(34, 197, 94, 0.1)',
            tension: 0.4,
            fill: true
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: 'Rung Ä‘á»™ng (mm/s)',
              color: 'gray',
              font: { size: 12 }
            },
            ticks: { color: 'gray', font: { size: 10 } },
            grid: { color: 'rgba(0,0,0,0.1)' }
          },
          x: {
            title: {
              display: true,
              text: 'Thá»i gian',
              color: 'gray',
              font: { size: 12 }
            },
            ticks: { color: 'gray', font: { size: 10 } },
            grid: { color: 'rgba(0,0,0,0.1)' }
          }
        },
        plugins: {
          legend: { display: true } // Hiá»ƒn thá»‹ legend Ä‘á»ƒ phÃ¢n biá»‡t X, Y, Z
        }
      }
    });

    const voltageChart = new Chart(document.getElementById('voltageChart').getContext('2d'), {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Äiá»‡n Ã¡p (V)',
          data: [],
          borderColor: 'rgb(59, 130, 246)',
          backgroundColor: 'rgba(59, 130, 246, 0.1)',
          tension: 0.4,
          fill: true
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: false,
            title: {
              display: true,
              text: 'Äiá»‡n Ã¡p (V)',
              color: 'gray',
              font: { size: 12 }
            },
            ticks: { color: 'gray', font: { size: 10 } },
            grid: { color: 'rgba(0,0,0,0.1)' }
          },
          x: {
            title: {
              display: true,
              text: 'Thá»i gian',
              color: 'gray',
              font: { size: 12 }
            },
            ticks: { color: 'gray', font: { size: 10 } },
            grid: { color: 'rgba(0,0,0,0.1)' }
          }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });

    const currentChart = new Chart(document.getElementById('currentChart').getContext('2d'), {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'DÃ²ng Ä‘iá»‡n (A)',
          data: [],
          borderColor: 'rgb(239, 68, 68)',
          backgroundColor: 'rgba(239, 68, 68, 0.1)',
          tension: 0.4,
          fill: true
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: 'DÃ²ng Ä‘iá»‡n (A)',
              color: 'gray',
              font: { size: 12 }
            },
            ticks: { color: 'gray', font: { size: 10 } },
            grid: { color: 'rgba(0,0,0,0.1)' }
          },
          x: {
            title: {
              display: true,
              text: 'Thá»i gian',
              color: 'gray',
              font: { size: 12 }
            },
            ticks: { color: 'gray', font: { size: 10 } },
            grid: { color: 'rgba(0,0,0,0.1)' }
          }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });

    // HÃ m láº¥y dá»¯ liá»‡u tá»« API vÃ  cáº­p nháº­t biá»ƒu Ä‘á»“
    async function fetchSensorData() {
      try {
        const response = await fetch('http://127.0.0.1:8000/Láº¥y dá»¯ liá»‡u tá»« Database/', {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json',
          }
        });
        if (!response.ok) {
          throw new Error('KhÃ´ng thá»ƒ láº¥y dá»¯ liá»‡u tá»« API');
        }
        const data = await response.json();

        // Xá»­ lÃ½ dá»¯ liá»‡u
        const labels = data.map(item => new Date(item.timestamp).toLocaleTimeString('vi-VN'));
        const temperatures = data.map(item => item.temperature);
        const voltages = data.map(item => item.voltage);
        const currents = data.map(item => item.current);
        const vibrationX = data.map(item => item.x);
        const vibrationY = data.map(item => item.y);
        const vibrationZ = data.map(item => item.z);

        // Cáº­p nháº­t biá»ƒu Ä‘á»“ nhiá»‡t Ä‘á»™
        temperatureChart.data.labels = labels;
        temperatureChart.data.datasets[0].data = temperatures;
        temperatureChart.update();

        // Cáº­p nháº­t biá»ƒu Ä‘á»“ rung Ä‘á»™ng
        vibrationChart.data.labels = labels;
        vibrationChart.data.datasets[0].data = vibrationX;
        vibrationChart.data.datasets[1].data = vibrationY;
        vibrationChart.data.datasets[2].data = vibrationZ;
        vibrationChart.update();

        // Cáº­p nháº­t biá»ƒu Ä‘á»“ Ä‘iá»‡n Ã¡p
        voltageChart.data.labels = labels;
        voltageChart.data.datasets[0].data = voltages;
        voltageChart.update();

        // Cáº­p nháº­t biá»ƒu Ä‘á»“ dÃ²ng Ä‘iá»‡n
        currentChart.data.labels = labels;
        currentChart.data.datasets[0].data = currents;
        currentChart.update();

      } catch (error) {
        console.error('Lá»—i khi láº¥y dá»¯ liá»‡u:', error);
        alert('KhÃ´ng thá»ƒ táº£i dá»¯ liá»‡u tá»« server. Vui lÃ²ng kiá»ƒm tra káº¿t ná»‘i hoáº·c server.');
      }
    }

    // Gá»i hÃ m láº¥y dá»¯ liá»‡u ngay khi táº£i trang
    fetchSensorData();

    // Cáº­p nháº­t dá»¯ liá»‡u má»—i 1 giÃ¢y
    setInterval(fetchSensorData, 1000);
  </script>
</body>
</html>