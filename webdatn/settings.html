<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>H·ªá th·ªëng Gi√°m s√°t ƒê·ªông c∆° C√¥ng nghi·ªáp - C√†i ƒë·∫∑t</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Hi·ªáu ·ª©ng chuy·ªÉn ƒë·ªông m∆∞·ª£t m√† cho sidebar */
    .sidebar-item {
      transition: all 0.3s ease-in-out;
    }
    .sidebar-item:hover {
      transform: translateX(5px);
    }
    /* Hi·ªáu ·ª©ng cho main content */
    .main-content {
      animation: fadeIn 0.5s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    /* ƒê√°nh d·∫•u m·ª•c active */
    .sidebar-item.active {
      background-color: rgba(255, 255, 255, 0.1);
      font-weight: bold;
      border-left: 4px solid #ffffff;
    }
    /* T√πy ch·ªânh b·∫£ng thi·∫øt b·ªã */
    .device-table {
      width: 100%;
      border-collapse: collapse;
    }
    .device-table th, .device-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
    }
    .device-table th {
      background-color: #f3f4f6;
      color: #374151;
      font-weight: bold;
    }
    .device-table tr:hover {
      background-color: #f9fafb;
    }
  </style>
</head>
<body class="bg-gray-50 font-sans antialiased">

  <div class="flex h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-gradient-to-b from-blue-700 to-blue-900 text-white shadow-xl">
      <div class="p-4 text-2xl font-extrabold border-b border-blue-500/30 flex items-center">
        <span class="mr-3">‚öôÔ∏è</span>Gi√°m S√°t ƒê·ªông C∆°
      </div>
      <nav class="mt-4">
        <ul>
          <li class="px-4 py-3 text-lg hover:bg-blue-600/80 cursor-pointer rounded-r-lg flex items-center sidebar-item">
            <a href="home.html" class="flex items-center w-full"><span class="mr-3">üè†</span> Home</a>
          </li>
          <li class="px-4 py-3 text-lg hover:bg-blue-600/80 cursor-pointer rounded-r-lg flex items-center sidebar-item">
            <a href="datarealtime.html" class="flex items-center w-full"><span class="mr-3">üìà</span> D·ªØ Li·ªáu Th·ªùi Gian Th·ª±c</a>
          </li>
          <li class="px-4 py-3 text-lg hover:bg-blue-600/80 cursor-pointer rounded-r-lg flex items-center sidebar-item">
            <a href="alert.html" class="flex items-center w-full"><span class="mr-3">üîç</span> Chu·∫©n ƒêo√°n L·ªói</a>
          </li>
          <li class="px-4 py-3 text-lg hover:bg-blue-600/80 cursor-pointer rounded-r-lg flex items-center sidebar-item">
            <a href="history.html" class="flex items-center w-full"><span class="mr-3">üìã</span> L·ªãch S·ª≠ S·ª± c·ªë</a>
          </li>
          <li class="px-4 py-3 text-lg hover:bg-blue-600/80 cursor-pointer rounded-r-lg flex items-center sidebar-item active">
            <a href="settings.html" class="flex items-center w-full"><span class="mr-3">‚öôÔ∏è</span> C√†i ƒê·∫∑t</a>
          </li>
          <li class="px-4 py-3 text-lg hover:bg-blue-600/80 cursor-pointer rounded-r-lg flex items-center sidebar-item">
            <a href="#" onclick="logout()" class="flex items-center w-full"><span class="mr-3">üö™</span> ƒêƒÉng Xu·∫•t</a>
          </li>
        </ul>
      </nav>
    </aside>

    <!-- N·ªôi dung ch√≠nh -->
    <main class="flex-1 p-4 main-content overflow-y-auto h-full">
      <!-- Header -->
      <div class="flex flex-col items-center mb-4">
        <h1 class="text-2xl font-bold text-gray-800 text-center">C√†i ƒë·∫∑t H·ªá th·ªëng</h1>
        <p class="text-sm text-gray-500 mt-1">C·∫≠p nh·∫≠t: <span id="current-time" class="font-semibold"></span></p>
      </div>

      <!-- Ph·∫ßn danh s√°ch thi·∫øt b·ªã -->
      <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Danh s√°ch Thi·∫øt b·ªã</h3>
        <table class="device-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>T√™n thi·∫øt b·ªã</th>
              <th>Tr·∫°ng th√°i</th>
            </tr>
          </thead>
          <tbody id="device-table-body"></tbody>
        </table>
      </div>

      <!-- Ph·∫ßn c√†i ƒë·∫∑t ng∆∞·ª°ng ch·∫©n ƒëo√°n l·ªói -->
      <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Ng∆∞·ª°ng Ch·∫©n ƒëo√°n L·ªói</h3>
        <form id="thresholds-form" class="space-y-4">
          <!-- Nhi·ªát ƒë·ªô -->
          <div class="flex items-center space-x-4">
            <label class="w-48 font-medium text-gray-700">Nhi·ªát ƒë·ªô t·ªëi ƒëa (¬∞C):</label>
            <input type="number" id="temp-threshold" step="0.1" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" value="80">
          </div>
          <!-- Rung ƒë·ªông -->
          <div class="flex items-center space-x-4">
            <label class="w-48 font-medium text-gray-700">Rung ƒë·ªông t·ªëi ƒëa (mm/s):</label>
            <input type="number" id="vib-threshold" step="0.1" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" value="10">
          </div>
          <!-- ƒêi·ªán √°p -->
          <div class="flex items-center space-x-4">
            <label class="w-48 font-medium text-gray-700">ƒêi·ªán √°p t·ªëi thi·ªÉu (V):</label>
            <input type="number" id="volt-min" step="0.1" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" value="200">
          </div>
          <div class="flex items-center space-x-4">
            <label class="w-48 font-medium text-gray-700">ƒêi·ªán √°p t·ªëi ƒëa (V):</label>
            <input type="number" id="volt-max" step="0.1" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" value="250">
          </div>
          <!-- D√≤ng ƒëi·ªán -->
          <div class="flex items-center space-x-4">
            <label class="w-48 font-medium text-gray-700">D√≤ng ƒëi·ªán t·ªëi ƒëa (A):</label>
            <input type="number" id="curr-threshold" step="0.1" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" value="15">
          </div>
          <!-- N√∫t l∆∞u -->
          <div class="flex justify-end">
            <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">L∆∞u C√†i ƒë·∫∑t</button>
          </div>
        </form>
      </div>

      <!-- Ph·∫ßn c√†i ƒë·∫∑t GFI (Ground Fault Interrupter) -->
      <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">C√†i ƒë·∫∑t B·∫£o v·ªá L·ªói N·ªëi ƒê·∫•t (GFI)</h3>
        <form id="gfi-form" class="space-y-4">
          <!-- Ng∆∞·ª°ng d√≤ng r√≤ -->
          <div class="flex items-center space-x-4">
            <label class="w-48 font-medium text-gray-700">Ng∆∞·ª°ng d√≤ng r√≤ t·ªëi ƒëa (mA):</label>
            <input type="number" id="gfi-leakage" step="0.1" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" value="30">
          </div>
          <!-- Th·ªùi gian ph·∫£n ·ª©ng -->
          <div class="flex items-center space-x-4">
            <label class="w-48 font-medium text-gray-700">Th·ªùi gian ph·∫£n ·ª©ng (ms):</label>
            <input type="number" id="gfi-response-time" step="1" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" value="50">
          </div>
          <!-- ƒê·ªô nh·∫°y -->
          <div class="flex items-center space-x-4">
            <label class="w-48 font-medium text-gray-700">ƒê·ªô nh·∫°y (Type A/B):</label>
            <select id="gfi-sensitivity" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
              <option value="A">Type A (AC)</option>
              <option value="B">Type B (AC + DC)</option>
            </select>
          </div>
          <!-- Tr·∫°ng th√°i k√≠ch ho·∫°t -->
          <div class="flex items-center space-x-4">
            <label class="w-48 font-medium text-gray-700">Tr·∫°ng th√°i k√≠ch ho·∫°t:</label>
            <select id="gfi-enabled" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
              <option value="true">B·∫≠t</option>
              <option value="false">T·∫Øt</option>
            </select>
          </div>
          <!-- N√∫t l∆∞u GFI -->
          <div class="flex justify-end">
            <button type="submit" class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500">L∆∞u C√†i ƒë·∫∑t GFI</button>
          </div>
        </form>
      </div>
    </main>
  </div>

  <script>
    // H√†m ƒëƒÉng xu·∫•t
    function logout() {
      localStorage.removeItem("username");
      alert("ƒêƒÉng xu·∫•t th√†nh c√¥ng!");
      window.location.href = "login.html";
    }

    // C·∫≠p nh·∫≠t th·ªùi gian hi·ªán t·∫°i
    function updateTime() {
      const now = new Date();
      document.getElementById('current-time').textContent = now.toLocaleString('vi-VN');
    }
    updateTime();
    setInterval(updateTime, 1000);

    // H√†m l·∫•y v√† hi·ªÉn th·ªã danh s√°ch thi·∫øt b·ªã t·ª´ API
    async function fetchAndDisplayDevices() {
      try {
        const response = await fetch('http://127.0.0.1:8000/devices/', {
          method: 'GET',
          headers: { 'Content-Type': 'application/json' }
        });
        if (!response.ok) {
          throw new Error('Kh√¥ng th·ªÉ l·∫•y danh s√°ch thi·∫øt b·ªã t·ª´ API');
        }
        const devices = await response.json();

        // Hi·ªÉn th·ªã thi·∫øt b·ªã trong b·∫£ng
        const tableBody = document.getElementById('device-table-body');
        tableBody.innerHTML = ''; // X√≥a n·ªôi dung c≈©
        devices.forEach(device => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${device.id}</td>
            <td>${device.device_name}</td>
            <td>${device.status}</td>
          `;
          tableBody.appendChild(row);
        });

      } catch (error) {
        console.error('L·ªói khi l·∫•y d·ªØ li·ªáu:', error);
        alert('Kh√¥ng th·ªÉ t·∫£i danh s√°ch thi·∫øt b·ªã t·ª´ server. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi ho·∫∑c server.');
      }
    }

    // T·∫£i c√†i ƒë·∫∑t t·ª´ localStorage khi trang t·∫£i
    function loadSettings() {
      const thresholds = JSON.parse(localStorage.getItem('thresholds')) || {};
      document.getElementById('temp-threshold').value = thresholds.temperature || 80;
      document.getElementById('vib-threshold').value = thresholds.vibration || 10;
      document.getElementById('volt-min').value = thresholds.voltageMin || 200;
      document.getElementById('volt-max').value = thresholds.voltageMax || 250;
      document.getElementById('curr-threshold').value = thresholds.current || 15;

      const gfiSettings = JSON.parse(localStorage.getItem('gfiSettings')) || {};
      document.getElementById('gfi-leakage').value = gfiSettings.leakage || 30;
      document.getElementById('gfi-response-time').value = gfiSettings.responseTime || 50;
      document.getElementById('gfi-sensitivity').value = gfiSettings.sensitivity || 'A';
      document.getElementById('gfi-enabled').value = gfiSettings.enabled || 'true';
    }

    // L∆∞u c√†i ƒë·∫∑t ng∆∞·ª°ng ch·∫©n ƒëo√°n l·ªói
    document.getElementById('thresholds-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const thresholds = {
        temperature: parseFloat(document.getElementById('temp-threshold').value),
        vibration: parseFloat(document.getElementById('vib-threshold').value),
        voltageMin: parseFloat(document.getElementById('volt-min').value),
        voltageMax: parseFloat(document.getElementById('volt-max').value),
        current: parseFloat(document.getElementById('curr-threshold').value)
      };
      localStorage.setItem('thresholds', JSON.stringify(thresholds));
      alert('ƒê√£ l∆∞u c√†i ƒë·∫∑t ng∆∞·ª°ng ch·∫©n ƒëo√°n l·ªói!');
    });

    // L∆∞u c√†i ƒë·∫∑t GFI
    document.getElementById('gfi-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const gfiSettings = {
        leakage: parseFloat(document.getElementById('gfi-leakage').value),
        responseTime: parseInt(document.getElementById('gfi-response-time').value),
        sensitivity: document.getElementById('gfi-sensitivity').value,
        enabled: document.getElementById('gfi-enabled').value === 'true'
      };
      localStorage.setItem('gfiSettings', JSON.stringify(gfiSettings));
      alert('ƒê√£ l∆∞u c√†i ƒë·∫∑t GFI!');
    });

    // T·∫£i c√†i ƒë·∫∑t v√† danh s√°ch thi·∫øt b·ªã khi trang ƒë∆∞·ª£c t·∫£i
    loadSettings();
    fetchAndDisplayDevices();

    // C·∫≠p nh·∫≠t danh s√°ch thi·∫øt b·ªã m·ªói 10 gi√¢y
    setInterval(fetchAndDisplayDevices, 10000);
  </script>
</body>
</html>